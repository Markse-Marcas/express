import{c as f,a as S,i as x,d as P,b as p,s as R,t as g,e as Q,f as E,A as V}from"./index-57880aa4.js";import{s as h}from"./supabaseClient-fe222147.js";const X=g('<div aria-live="polite"><div><label class="" for="single"></label><span style="display:none"><input type="file" class="file-input w-full max-w-xs" id="single" accept="image/*">'),Z=g('<img class="">'),ee=g('<div class="">'),te=l=>{const[d,_]=f(null),[b,v]=f(!1);S(()=>{l.url&&m(l.url)});const m=async i=>{try{const{data:a,error:o}=await h.storage.from("avatars").download(i);if(o)throw o;const u=URL.createObjectURL(a);_(u)}catch(a){a instanceof Error&&console.log("Error downloading image: ",a.message)}},c=async i=>{try{v(!0);const a=i.currentTarget;if(!a?.files||a.files.length===0)throw new Error("You must select an image to upload.");const o=a.files[0],u=o.name.split(".").pop(),n=`${`${Math.random()}.${u}`}`;let{error:t}=await h.storage.from("avatars").upload(n,o);if(t)throw t;l.onUpload(i,n)}catch(a){a instanceof Error&&alert(a.message)}finally{v(!1)}};return(()=>{const i=X(),a=i.firstChild,o=a.firstChild,u=o.nextSibling,$=u.firstChild;return x(i,(()=>{const n=P(()=>!!d());return()=>n()?(()=>{const t=Z();return p(e=>{const r=d(),s=d()?"Avatar":"No image",C=`${l.size}px`,w=`${l.size}px`;return r!==e._v$4&&R(t,"src",e._v$4=r),s!==e._v$5&&R(t,"alt",e._v$5=s),C!==e._v$6&&((e._v$6=C)!=null?t.style.setProperty("height",C):t.style.removeProperty("height")),w!==e._v$7&&((e._v$7=w)!=null?t.style.setProperty("width",w):t.style.removeProperty("width")),e},{_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),t})():(()=>{const t=ee();return p(e=>{const r=`${l.size}px`,s=`${l.size}px`;return r!==e._v$8&&((e._v$8=r)!=null?t.style.setProperty("height",r):t.style.removeProperty("height")),s!==e._v$9&&((e._v$9=s)!=null?t.style.setProperty("width",s):t.style.removeProperty("width")),e},{_v$8:void 0,_v$9:void 0}),t})()})(),a),x(o,()=>b()?"Atualizando...":"Atualizar foto"),$.addEventListener("change",c),p(n=>{const t=`${l.size}px`,e=`${l.size}px`,r=b();return t!==n._v$&&((n._v$=t)!=null?i.style.setProperty("width",t):i.style.removeProperty("width")),e!==n._v$2&&((n._v$2=e)!=null?a.style.setProperty("width",e):a.style.removeProperty("width")),r!==n._v$3&&($.disabled=n._v$3=r),n},{_v$:void 0,_v$2:void 0,_v$3:void 0}),i})()},le=g('<div class="flex flex-col" aria-live="polite"><form><div class="grid grid-cols-1"><div class="avatar"><div class="w-24 rounded"></div></div><div class="form-control"><label class="input-group"><span>E-mail</span><input type="text" class="input input-bordered w-full max-w-xs" disabled></label></div><div class="form-control"><label class="input-group"><span>Username</span><input type="text" id="username" class="input input-bordered w-full max-w-xs"></label></div><div class="form-control"><label class="input-group"><span>Nome</span><input type="text" id="name" class="input input-bordered w-full max-w-xs"></label></div><div class="form-control"><label class="input-group"><span>Telefone celular</span><input type="text" id="name" class="input input-bordered w-full max-w-xs"></label></div><div><button type="submit" class="btn"></button></div><button type="button" class="btn">Sair'),ae=({session:l})=>{const[d,_]=f(null),[b,v]=f(!0),[m,c]=f(null),[i,a]=f(null),[o,u]=f(null);S(()=>{$()});const $=async()=>{try{v(!0);const{user:t}=l;let{data:e,error:r,status:s}=await h.from("profiles").select("username, name, phone, avatar_url").eq("id",t.id).single();if(r&&s!==406)throw r;e&&(u(e.username),c(e.name),a(e.phone),_(e.avatar_url))}catch(t){t instanceof Error&&alert(t.message)}finally{v(!1)}},n=async t=>{t.preventDefault();try{v(!0);const{user:e}=l,r={id:e.id,username:o(),name:m(),phone:i(),avatar_url:d(),updated_at:new Date().toISOString()};let{error:s}=await h.from("profiles").upsert(r);if(s)throw s}catch(e){e instanceof Error&&alert(e.message)}finally{v(!1)}};return(()=>{const t=le(),e=t.firstChild,r=e.firstChild,s=r.firstChild,C=s.firstChild,w=s.nextSibling,I=w.firstChild,M=I.firstChild,j=M.nextSibling,A=w.nextSibling,W=A.firstChild,Y=W.firstChild,L=Y.nextSibling,z=A.nextSibling,B=z.firstChild,F=B.firstChild,U=F.nextSibling,T=z.nextSibling,G=T.firstChild,H=G.firstChild,k=H.nextSibling,N=T.nextSibling,O=N.firstChild,J=N.nextSibling;return x(t,E(V,{href:"/pages/brands",children:"Suas marcas"}),e),e.addEventListener("submit",n),x(C,E(te,{get url(){return d()},size:220,onUpload:(y,K)=>{_(K),n(y)}})),L.addEventListener("change",y=>u(y.currentTarget.value)),U.addEventListener("change",y=>c(y.currentTarget.value)),k.addEventListener("change",y=>a(y.currentTarget.value)),x(O,()=>b()?"Salvando...":"Atualizar perfil"),J.$$click=()=>h.auth.signOut(),p(()=>O.disabled=b()),p(()=>j.value=l.user.email),p(()=>L.value=o()||""),p(()=>U.value=m()||""),p(()=>k.value=i()||""),t})()};Q(["click"]);const re=g('<div class="hero min-h-screen bg-base-200" aria-live="polite"><div class="hero-content flex-col lg:flex-row-reverse"><div class="text-center lg:text-left"><h1 class="text-5xl font-bold">Entrar</h1><p class="py-6">Autentique-se para poder ver o(s) statu(s) da(s) tua(s) marca(s)</p></div><div class="card flex-shrink-0 w-full max-w-sm shadow-2xl bg-base-100"><form><div class="card-body"><div class="form-control"><label class="label"><span class="label-text">E-mail</span></label><input type="email" placeholder="marca@dominio.com" class="input input-bordered"></div><div class="form-control mt-6"><button type="submit" class="btn btn-primary" aria-live="polite">'),se=g("<span>Carregando..."),ne=g("<span>Enviar link");function ie(){const[l,d]=f(!1),[_,b]=f(""),v=async m=>{m.preventDefault();try{d(!0);const{error:c}=await h.auth.signInWithOtp({email:_(),options:{emailRedirectTo:"http://localhost:3000/profile"}});if(c)throw c;alert("Cheque o teu e-mail para visualizar o link de acesso!")}catch(c){c instanceof Error&&alert(c.message)}finally{d(!1)}};return(()=>{const m=re(),c=m.firstChild,i=c.firstChild,a=i.nextSibling,o=a.firstChild,u=o.firstChild,$=u.firstChild,n=$.firstChild,t=n.nextSibling,e=$.nextSibling,r=e.firstChild;return o.addEventListener("submit",v),t.addEventListener("change",s=>b(s.currentTarget.value)),x(r,(()=>{const s=P(()=>!!l());return()=>s()?se():ne()})()),p(()=>t.value=_()),m})()}const oe=g('<div class="md:container md:mx-auto">'),[q,D]=f(null),ue=()=>(S(()=>{h.auth.getSession().then(({data:{session:l}})=>{D(l)}),h.auth.onAuthStateChange((l,d)=>{D(d)})}),(()=>{const l=oe();return x(l,(()=>{const d=P(()=>!q());return()=>d()?E(ie,{}):E(ae,{get session(){return q()}})})()),l})());export{ue as default,q as session,D as setSession};
